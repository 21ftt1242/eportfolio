<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Speech Synthesis Test</title>
	<style type="text/css">
		#story1 {
			width: 50%;
		}
	</style>
</head>
<body>

<button id="play-button" onclick="playText()">Play</button>
<button id="pause-button" onclick="pauseText()">Pause</button>
<button id="stop-button" onclick="stopText()">Stop</button>
<br>
<br>
<div>
	<select id="voice-select"></select>
</div>
<br>
<br>
<div id="story1">

</div>
<br><br>
<button id="stop-button" onclick="nextPage()">Next page</button>


<!-- Import External Javascript -->
<script src="storage.js"></script>

<script type="text/javascript">



	// Declare variables
const playButton = document.getElementById("play-button");
const pauseButton = document.getElementById("pause-button");
const stopButton = document.getElementById("stop-button");
const voiceSelect = document.getElementById("voice-select");
const synth = window.speechSynthesis;

// Get Story text
var text = document.getElementById("story1").innerText;
document.getElementById("story1").innerHTML = localStorage.getItem("story-1a");

function nextPage() {
document.getElementById("story1").innerHTML = localStorage.getItem("story-1b");
text = document.getElementById("story1").innerText;
console.log(text);
}

// Get speak text
let pageOne = new SpeechSynthesisUtterance(text);

// Array of voices
let voices = [];

// ----------Call Populate Voice function----------
populateVoices();

// ----------Populate Voice function----------
function populateVoices() {
	voices = synth.getVoices();
	// Loop through voices and create option for each one
	voices.forEach(voice => {
	
		// Create option element
		let listItem = document.createElement('option');
	
		// Fill option with voice and language
		listItem.textContent = voice.name + '('+ voice.lang +')';

		// Set needed listItem attributes
		listItem.setAttribute('data-lang', voice.lang);
		listItem.setAttribute('data-name', voice.name);
		voiceSelect.appendChild(listItem);
	});
};

if(synth.onvoiceschanged !== undefined) {
	synth.onvoiceschanged = populateVoices;
}

// ----------Play Button----------

function playText(story1) {
	let selectedVoice = voiceSelect.selectedOptions[0].getAttribute('data-name');

	voices.forEach((voice) => {
		if(voice.name === selectedVoice) {
		pageOne.voice = voice;
			}
		});

	synth.speak(pageOne);

	if (speechSynthesis.paused && speechSynthesis.speaking) {
		return speechSynthesis.resume();
	}
};

// ----------Pause Button----------

function pauseText() {
	if (speechSynthesis.speaking) {
		speechSynthesis.pause();
	}
}

// ----------Stop Button----------

function stopText() {
	speechSynthesis.resume();
	speechSynthesis.cancel();
}

</script>
</body>
</html>