# **21FTT1283**  
  
  - 21ftt1283@student.pb.edu.bn  
  
<br>  
  
# **ASSIGNMENT 1 - VPS DEPLOYMENT**  
  
### **Table of Content**  
1. [New SSH Key & Droplet](#1-–-new-ssh-key--droplet)  
    1.1 SSH Key Creation  
    1.2 Droplet Creation  
2. [Create Config File](#2-–-create-config-file)  
3. [Logging in as Root](#3-–-logging-in-as-root)  
4. [Create New Non-Root User](#4-–-create-new-non-root-user)  
    4.1 Grant Administrative Privileges (Sudo)  
    4.2 Setting Up Firewall  
    4.3 Enable External Access for Non-Root User  
5. [SSH Configuration](#5-–-ssh-configuration)  
6. [Open Custom Port](#6-–-open-custom-port)  
7. [Install and Enable Nginx](#7-–-install-and-enable-nginx)  
    7.1 Setting Up Server Blocks  
8. [Change Timezone](#8-–-change-timezone)  
9. [Additional Info](#9-–-additional-info)  
  
<br>  
  
## 1 – **New SSH Key & Droplet**  
> #### *SSH Key Creation*    
  
- Open terminal and create normal key gen:  

        > ssh-keygen  
        > File Name: sop_as1  
  
- Create ed25519 encrypted key with comment of student email:  
  
        > ssh-keygen -t ed25519 -C "21ftt1283@student.pb.edu.bn"   
        > File Name: sop_as1  
        > Overwrite (Y/n): Y 
  
> #### *Droplet Creation*  
  
  1. Login to DigitalOcean  
  2. Create 'droplet' in project  
  3. Options:  
        a) Region: `Singapore`  
        b) Image OS: `Ubuntu 22.04 (LTS)`  
        c) Droplet Type: `Basic Plan`  
        d) CPU Options: `Regular - Disk type: SSD`  
        e) Pricing: `$6/month`  
        f) SSH Key: `sop_as1.pub`  
        g) Hostname: `sop-as1`  
  4. Create Droplet  
  5. IP Address: `68.183.182.92`  
  
<br> 
  
## 2 – **Create Config File**  
  
  1. Go to terminal and create config file using notepad in .ssh folder  

         > notepad config  
  2. Details of `config` file:    

         Host as1
            HostName 68.183.182.92  
            User ftt1283  
            IdentityFile ~/.ssh/sop_as1  
  
  3. Save file and close
   
<br>  
  
## 3 – **Logging in as Root**  
  
  - Go to terminal and type:  

         > ssh root@68.183.182.92  
         OR  
         > ssh root@as1

  - Output should indicate that you have logged in as root
  
<br>  
  
## 4 – **Create New Non-Root User**  
  
  1. Add new user:  

         # adduser ftt1283  
         # password  
  
  > #### *Grant Administrative Privileges (Sudo)*  
    
  - Add the newly created user to the `sudo` group  
  
         # usermod -aG sudo ftt1283  
  

  > #### *Setting Up Firewall*  
  1. Check on the ufw list of profiles that has been installed  
  
         # ufw app list  
           
         Available applications:  
            OpenSSH  
  
  2. Command selected firewall to allow selected SSH connection  
  
         # ufw allow OpenSSH  
  
  3. Enable the firewall   
  
         # ufw enable  

  4. Check on the SSH connection and see if OpenSSH is allowed  
  
         # sudo ufw reload  
         # ufw status  

         Status: active  
         To                 Action      From  
         --                 -----       ----  
         OpenSSH            ALLOW       Anywhere  
         OpenSSH (v6)       ALLOW       Anywhere  
  
  > #### *Enable External Access for Non-Root User*  
  1. Using SSH, enable the user's external access:  
  
         # rsync --archive --chown=ftt1283:ftt1283 ~/.ssh /home/ftt1283  
  
  2. Exit from root and login to non-root user  
  
         # exit  
         > ssh ftt1283@68.183.182.92  
         OR  
         > ssh ftt1283@as1  
  
<br>  
  
## 5 – **SSH Configuration**  
  
  1. Configure the user with conditions based off assignment:

         $ sudo nano /etc/ssh/sshd_config  
  
  2. Start configure the settings to below:  
  
       |No.|             Conditions             |     Implement Settings      |
       | - | ---------------------------------- | --------------------------- |
       | 1 | Add custom port                   :| Port `7822`                 |
       | 2 | Do not allow password             :| PasswordAuthentication `no` |
       | 3 | Allow public key authentication   :| PubkeyAuthentication `yes`  |
       | 4 | Do not allow root to login        :| PermitRootLogin `no`        |
       | 5 | Maximum authentication tries of 3 :| MaxAuthTries `3`            |
  
  3. Reload to implement the changes:   
  
         $ sudo service ssh restart  

  4. Try to login as root: *(An error will show up that root cannot be connected)*   
  
         $ exit  
         > ssh root@as1  
         OR  
         > ssh as1  
  
<br>  
  
## 6 – **Open Custom Port**  
  
  1. Login as user:  
    
         > ssh ftt1283@68.183.182.92  
         OR  
         > ssh ftt1283@as1  
  
  2. To allow custom port:  
  
         $ sudo ufw status  
         $ sudo ufw allow 7822  

         Rule added  
         Rule added (v6)  

         $ sudo ufw reload  
         $ sudo ufw status  

         Status: active  
         To                 Action      From  
         --                 -----       ----  
         OpenSSH            ALLOW       Anywhere  
         7822               ALLOW       Anywhere  
         OpenSSH (v6)       ALLOW       Anywhere  
         7822 (v6)          ALLOW       Anywhere  
  
  3. Remove default port  

         $ sudo ufw delete allow "OpenSSH"  

         Rule deleted  
         Rule deleted (v6)  

         $ sudo ufw reload  
         $ sudo ufw status  

         Status: active  
         To                 Action      From  
         --                 -----       ----  
         7822               ALLOW       Anywhere  
         7822 (v6)          ALLOW       Anywhere  

  4. Try to login with custom Host and port  
  
         $ exit  
         > ssh -p 7822 as1  
  
<br>  
  
## 7 – **Install and Enable Nginx**  
  
  1. Install Nginx:  

         $ sudo apt update  
         $ sudo apt install nginx  
  
  2. Check firewall list and allow Nginx  
    
         $ sudo ufw app list  
         $ sudo ufw allow 'Nginx HTTP'  
         $ sudo ufw status  

         Status: active  
         To                 Action      From  
         --                 -----       ----  
         7822               ALLOW       Anywhere  
         Nginx HTTP         ALLOW       Anywhere  
         7822 (v6)          ALLOW       Anywhere  
         Nginx HTTP (v6)    ALLOW       Anywhere  
  
 3. Check if Nginx is working  

         $ sudo systemctl status nginx  
  
  4. Check the link?  
  
         $ curl -4 icanhazip.com  

         68.183.182.92  

> #### *Setting Up Server Blocks*
  
  1. Create directory for `IP address`  
  
         $ sudo mkdir -p /var/www/68.183.182.92/html  
  
  2. Assign ownership of the firectory to the `$USER` environment variable  
  
         $ sudo chown -R $USER:$USER /var/www/your_domain/html  
  
  3. Allow owner to read, write and execute  
  
         $ sudo chmod -R 755 /var/www/68.183.182.92  
  
  4. Create an index.html file with necessary details included  
  
         $ nano /var/www/68.183.182.92/html/index.html  
         
         <!DOCTYPE html> <html lang="en">  
         <head>  
            <meta charset="UTF-8">  
            <title>SysOps Assignment 1</title>  
         </head>  
         <body>  
            Welcome to my website on my VPS on the cloud!  
            <br>  
            My ID is 21FTT1283  
         </body>  
         </html>  
  
  5. Create a server block to serve the content of index.html with necessary server block info  
  
         $ sudo nano /etc/nginx/sites-available/68.183.182.92  
           
         server {  
                 listen 80;  
                 listen [::]:80;  

                 root /var/www/68.183.182.92/html;  
                 index index.html index.htm index.nginx-debian.html;  

                 server_name 68.183.182.92  www.68.183.182.92;  

                 location / {  
                         try_files $uri $uri/ =404;  
                 }  
         }  
  
  6. Create and check link from sites-enabled directory for Nginx to read  
  
         $ sudo ln -s /etc/nginx/sites-available/68.183.182.92 /etc/nginx/sites-enabled/  
  
  7. Adjust single value in config file  
  
         $ sudo nano /etc/nginx/nginx.conf  
  
  8. Test Nginx file and restart  
  
         $ sudo nginx -t  

         nginx: the configuration file /etc/nginx/nginx.conf syntax is ok  
         nginx: configuration file /etc/nginx/nginx.conf test is successful  

         $ sudo systemctl restart nginx  
  
<br>  
   
## 8 – **Change Timezone**  
  
  1. Check the current timezone of the user  
  
         $ timedatectl  

         Local time: Mon 2023-08-21 10:53:32 UTC  
         Universal time: Mon 2023-08-21 10:53:32 UTC  
         RTC time: Mon 2023-08-21 10:53:32  
         Time zone: Etc/UTC (UTC, +0000)  
         System clock synchronized: yes  
         NTP service: active  
         RTC in local TZ: no  
  
  2. Check the time list from Asia  
  
         $ timedatectl list-timezones | grep Asia  
  
  3. Set the timezone to Singapore  
  
         $ sudo timedatectl set-timezone Asia/Singapore  

         Local time: Mon 2023-08-21 18:54:24 +08  
         Universal time: Mon 2023-08-21 10:53:24 UTC  
         RTC time: Mon 2023-08-21 10:54:24  
         Time zone: Asia/Singapore (+08, +0800)  
         System clock synchronized: yes  
         NTP service: active  
         RTC in local TZ: no  
  
  4. Verify the changes by checking the timezone  
  
         $ timedatectl  
  
<br>  
  
## 9 – **Additional Info**  
  
  1. Change to root when root has already been disabled for login  

         $ sudo -i  
         # exit
   
   
<br>  

---  

*Date & time assignment created: Monday, 21th August 2023 @ 10.00am*  
